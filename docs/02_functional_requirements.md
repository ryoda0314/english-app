# 機能要件仕様書

## 2. 認証機能 (Authentication)

### 2.1 ユーザー登録
| 項目 | 詳細 |
|------|------|
| 画面ID | AUTH-001 |
| パス | `/register` |
| 認証状態 | 未認証のみ |

#### 入力フィールド
| フィールド | 型 | 必須 | バリデーション |
|-----------|-----|-----|---------------|
| email | string | ✓ | 有効なメールアドレス形式 |
| password | string | ✓ | 8文字以上、英数字混合 |
| confirmPassword | string | ✓ | passwordと一致 |
| displayName | string | ✓ | 2-20文字 |
| nativeLanguage | enum | ✓ | 'ja' \| 'en' \| 'zh' \| 'ko' |
| englishLevel | enum | ✓ | 'beginner' \| 'intermediate' \| 'advanced' |

#### 処理フロー
1. フォーム入力・バリデーション
2. Supabase Auth でアカウント作成
3. `profiles` テーブルにユーザー情報挿入
4. 確認メール送信
5. ログイン画面へリダイレクト

### 2.2 ログイン
| 項目 | 詳細 |
|------|------|
| 画面ID | AUTH-002 |
| パス | `/login` |

#### 入力フィールド
| フィールド | 型 | 必須 |
|-----------|-----|-----|
| email | string | ✓ |
| password | string | ✓ |

#### 処理フロー
1. Supabase Auth で認証
2. セッション作成
3. ホーム画面へリダイレクト

### 2.3 ソーシャルログイン
- Google OAuth
- Apple Sign In (将来)

### 2.4 パスワードリセット
1. メールアドレス入力
2. リセットリンク送信
3. 新パスワード設定

---

## 3. ホーム画面 (Home)

| 項目 | 詳細 |
|------|------|
| 画面ID | HOME-001 |
| パス | `/` |
| 認証状態 | 認証必須 |

### 表示要素
1. **ウェルカムメッセージ** - ユーザー名表示
2. **今日の学習サマリー**
   - 保存フレーズ数
   - 練習済みフレーズ数
   - 連続学習日数
3. **クイックアクション**
   - 「今日の日記を書く」ボタン
   - 「表現を学ぶ」ボタン
   - 「マイフレーズ帳」ボタン
4. **最近のフレーズ** - 直近保存した5件
5. **トレンドスラング** - 人気スラング3件

---

## 4. 小説的ストーリーシーン生成機能

### 4.1 表現入力画面
| 項目 | 詳細 |
|------|------|
| 画面ID | STORY-001 |
| パス | `/story` |

#### 入力フィールド
| フィールド | 型 | 必須 | 説明 |
|-----------|-----|-----|------|
| targetExpression | string | ✓ | 学びたい英語表現 or 日本語で状況 |
| supplement | string | - | 追加の文脈情報（任意） |

### 4.2 テーマ選択画面
| 項目 | 詳細 |
|------|------|
| 画面ID | STORY-002 |
| パス | `/story` (同一画面内) |

#### 表示要素
- テーマカード一覧（3-6件）
  - タイトル
  - 1行説明（日本語）
  - ジャンルアイコン
  - 感情タグ
  - 関係性タグ

### 4.3 シーン表示画面
| 項目 | 詳細 |
|------|------|
| 画面ID | STORY-003 |
| パス | `/story/[themeId]` |

#### 表示要素
1. **シーン情景** - 背景画像 or イラスト
2. **ストーリー本文** - 180-260 words
   - ターゲット表現をハイライト
3. **ニュアンス解説カード**
   - 感情タグ
   - 使用場面
   - 日本語解説
4. **アクションボタン**
   - 「フレーズを保存」
   - 「別のシーンを見る」
   - 「音声で聞く」

---

## 5. 日記ベース英会話フレーズ提案機能

### 5.1 日記入力画面
| 項目 | 詳細 |
|------|------|
| 画面ID | DIARY-001 |
| パス | `/diary` |

#### 入力フィールド
| フィールド | 型 | 必須 | 説明 |
|-----------|-----|-----|------|
| diaryTextJa | string | ✓ | 日記本文（日本語）, 50-1000文字 |
| emotionTags | string[] | - | 感情タグ（任意選択） |
| date | date | ✓ | 日記の日付（デフォルト: 今日） |

#### 感情タグ選択肢
```
緊張 / 安心 / 怒り / 悲しみ / 喜び / 驚き / 不安 / 期待 / 疲労 / 複雑
```

### 5.2 フレーズ提案結果画面
| 項目 | 詳細 |
|------|------|
| 画面ID | DIARY-002 |
| パス | `/diary/result` |

#### 表示要素
- **シーン分割カード**（最大5シーン）
  - シーン要約（日本語）
  - 感情タグ
  - 場所・関係性タグ
  - **フレーズリスト**（3-5件/シーン）
    - 英語フレーズ
    - 日本語解説
    - トーンバッジ
    - 保存ボタン
    - 音声再生ボタン

---

## 6. マイフレーズ帳機能

### 6.1 フレーズ一覧画面
| 項目 | 詳細 |
|------|------|
| 画面ID | PHRASE-001 |
| パス | `/phrases` |

#### 表示要素
- **フィルター**
  - ソース（日記/ストーリー/スラング）
  - 感情
  - 練習状態
- **フレーズカード一覧**
  - 英語フレーズ
  - ソースアイコン
  - 保存日
  - 練習ステータス

### 6.2 フレーズ詳細・練習画面
| 項目 | 詳細 |
|------|------|
| 画面ID | PHRASE-002 |
| パス | `/phrases/[id]` |

#### 表示要素
1. 英語フレーズ（大きく表示）
2. 日本語解説
3. ソース情報（どのシーン/日記から）
4. **音声セクション**
   - モデル音声再生ボタン
   - 録音ボタン
   - 自分の音声再生ボタン
5. **発音判定セクション**
   - 判定開始ボタン
   - 総合スコア表示
   - 単語別スコア
   - フィードバック
